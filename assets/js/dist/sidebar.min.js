!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=68)}([function(e,t){var n,i=window.jQuery;n=Marionette.ItemView.extend({tagName:"li",media:"desktop",ui:{input:"input",mediaButton:".js-setting-group .button",defaultButton:".js-default",controlGroups:".control__body > *"},events:{"blur @ui.input":"onFieldChange","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange"},className:function(){return"control control--"+this.model.get("type")},getTemplate:function(){return"#tmpl-tailor-control-"+this.model.get("type")},serializeData:function(){var e=Backbone.Marionette.ItemView.prototype.serializeData.apply(this,arguments);return e.values=this.getValues(),e.hideDefault=this.checkDefault(e.values),e=this.addSerializedData(e)},addSerializedData:function(e){return e},checkDefault:function(e){var t=!0;return _.each(this.getDefaults(),(function(n,i){_.isNull(n)||!e.hasOwnProperty(i)||_.isNull(e[i])||n===e[i]||(t=!1)})),t},initialize:function(){this.addEventListeners(),this.checkDependencies()},addEventListeners:function(){_.each(this.getSettings(),(function(e){this.listenTo(e,"change",this.onSettingChange)}),this),this.listenTo(this.getSetting().collection,"change",this.checkDependencies)},checkDependencies:function(e){e=e||this.getSetting();var t=this.model.get("dependencies"),n=e.collection,i=!0;for(var o in t)if(t.hasOwnProperty(o)){var s=n.get(o);if(!s)continue;var a=t[o].condition,l=s.get("value"),r=t[o].value;if(!Tailor.Helpers.checkCondition(a,l,r)){i=!1;break}}this.$el.toggle(i)},onRender:function(){this.updateControlGroups()},onMediaButtonChange:function(e){this.media=e.currentTarget.getAttribute("data-media"),app.channel.trigger("sidebar:device",this.media),this.updateControlGroups()},onDefaultButtonChange:function(){this.restoreDefaults(),this.render()},onFieldChange:function(){this.setValue(this.ui.input.filter('[name^="'+this.media+'"]').val())},onSettingChange:function(){this.updateDefaultButton()},updateControlGroups:function(){var e=this.media;this.ui.controlGroups.each((function(){i(this).toggleClass("is-hidden",e!=this.id)})),this.ui.mediaButton.each((function(){i(this).toggleClass("active",e==this.getAttribute("data-media"))}))},updateDefaultButton:function(){this.ui.defaultButton.toggleClass("is-hidden",this.checkDefault(this.getValues()))},getSettings:function(){return this.model.settings},getSetting:function(e){e=e||this.media;var t=this.getSettings();for(var n in t)if(t.hasOwnProperty(n)&&t[n].media==e)return t[n];return!1},getDefaults:function(){var e={};return _.each(this.getSettings(),(function(t){e[t.media]=t.get("default")})),e},getValues:function(){var e={};return _.each(this.getSettings(),(function(t){e[t.media]=t.get("value")||""})),e},getDefault:function(){return this.getSetting().get("default")},getValue:function(){return this.getSetting().get("value")},setValue:function(e){this.getSetting().set("value",e)},restoreDefaults:function(){_.each(this.getSettings(),(function(e){e.set("value",e.get("default"))}))}}),e.exports=n},,function(e,t){!function(e){"use strict";var t=document.createElement("fakeelement");e.animationEndName=function(){var e,n={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in n)if(n.hasOwnProperty(e)&&void 0!==t.style[e])return n[e];return!1}(),e.transitionEndName=function(){var e,n={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in n)if(n.hasOwnProperty(e)&&void 0!==t.style[e])return n[e];return!1}()}(window)},function(e,t){!function(){if(void 0!==window.Element&&!("classList"in document.documentElement)){var e,t,n,i=Array.prototype,o=i.push,s=i.splice,a=i.join;l.prototype={add:function(e){this.contains(e)||(o.call(this,e),this.el.className=this.toString())},contains:function(e){return-1!=this.el.className.indexOf(e)},item:function(e){return this[e]||null},remove:function(e){if(this.contains(e)){for(var t=0;t<this.length&&this[t]!=e;t++);s.call(this,t,1),this.el.className=this.toString()}},toString:function(){return a.call(this," ")},toggle:function(e){return this.contains(e)?this.remove(e):this.add(e),this.contains(e)}},window.DOMTokenList=l,e=Element.prototype,t="classList",n=function(){return new l(this)},Object.defineProperty?Object.defineProperty(e,t,{get:n}):e.__defineGetter__(t,n)}function l(e){this.el=e;for(var t=e.className.replace(/^\s+|\s+$/g,"").split(/\s+/),n=0;n<t.length;n++)o.call(this,t[n])}}()},function(e,t){!function(e){"use strict";for(var t=0,n=["ms","moz","webkit","o"],i=0;i<n.length&&!e.requestAnimationFrame;++i)e.requestAnimationFrame=e[n[i]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[n[i]+"CancelAnimationFrame"]||e[n[i]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(n,i){var o=(new Date).getTime(),s=Math.max(0,16-(o-t)),a=e.setTimeout((function(){n(o+s)}),s);return t=o+s,a}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)})}(window)},function(e,t){var n,i=jQuery;n={url:window.ajaxurl,post:function(e,t){return ajax.send({data:_.isObject(e)?e:_.extend(t||{},{action:e})})},send:function(e,t){return _.isObject(e)?t=e:(t=t||{}).data=_.extend(t.data||{},{action:e,tailor:1}),t=_.defaults(t||{},{type:"POST",url:ajax.url,context:this}),i.Deferred((function(e){t.success&&e.done(t.success);var n=t.error?t.error:ajax.onError;e.fail(n),delete t.success,delete t.error,i.ajax(t).done((function(t){"1"!==t&&1!==t||(t={success:!0}),_.isObject(t)&&!_.isUndefined(t.success)?e[t.success?"resolveWith":"rejectWith"](this,[t.data]):e.rejectWith(this,[t])})).fail((function(){e.rejectWith(this,arguments)}))})).promise()},onError:function(e){Tailor.Notify?e&&e.hasOwnProperty("message")?Tailor.Notify(e.message):"0"==e?Tailor.Notify(window._l10n.expired):"-1"==e?Tailor.Notify(window._l10n.invalid):Tailor.Notify(window._l10n.error):console.error(e)}},window.ajax=n,e.exports=n},,function(e,t){var n=Marionette.Behavior.extend({events:{dragstart:"onDragStart",dragend:"onDragEnd",drag:"onDrag"},onDragStart:function(e){app.channel.trigger("canvas:dragstart",e.originalEvent,this.view)},onDrag:function(e){app.channel.trigger("canvas:drag",e.originalEvent,this.view)},onDragEnd:function(e){app.channel.trigger("canvas:dragend",e.originalEvent,this.view)}});e.exports=n},,function(e,t){var n,i=(0,window.jQuery)(window),o=window.app,s={sidebar:[],element:[]};function a(e){return e&&_.contains(_.keys(n.stylesheets),e)||(e="all"),e}o.listenTo(o.channel,"sidebar:setting:change",(function(e){var t=e.get("id");_.isEmpty(s.sidebar[t])||(_.each(s.sidebar[t],(function(t){t.apply(window,[e.get("value"),e.previous("value")])})),i.trigger("resize"))})),o.listenTo(o.channel,"element:setting:change",(function(e,t){var i=t.model.get("id"),o=e.get("id");if(s.element.hasOwnProperty(o)&&0!=s.element[o].length){1==s.element[o].length&&n.deleteRules(i,o);var l,r={};_.each(s.element[o],(function(s){if("function"==typeof s)if(!1===(l=s.apply(t,[e.get("value"),e.previous("value"),t.model])))t.model.trigger("change:atts",t.model,t.model.get("atts"));else if(_.isArray(l)&&l.length>0){for(var c in l)if(l.hasOwnProperty(c)){if(!l[c].hasOwnProperty("selectors")||!l[c].hasOwnProperty("declarations"))continue;var d=a(l[c].media);r[d]=r[d]||{},r[d][i]=r[d][i]||[],_.keys(l[c].declarations).length>0&&r[d][i].push({selectors:l[c].selectors,declarations:l[c].declarations,setting:l[c].setting||o})}n.addRules(r)}}))}})),o.channel.on("module:css:stylesheets:ready",(function(e){n=e})),e.exports={onChange:function(e,t){var n=e.split(":");n.length>=2&&_.contains(["sidebar","element"],n[0])&&function(e,t,n){"function"==typeof n&&(s[e][t]=s[e][t]||[],s[e][t].push(n))}(n[0],n[1],t)}}},,,,,,,,,,,,function(e,t){var n=Backbone.Model.extend({defaults:function(){return{label:"",description:"",tag:"",icon:"",sections:[],controls:[],type:"default",child:"",collection:"library"}},initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"element:add:top",this.insertBefore),this.listenTo(this,"element:add:bottom",this.insertAfter),this.listenTo(this,"element:add:left",this.columnBefore),this.listenTo(this,"element:add:right",this.columnAfter),this.listenTo(this,"element:add:center",this.createChild)},insertBefore:function(e){this.insertAtIndex(e.model,e.model.get("order")-1)},insertAfter:function(e){this.insertAtIndex(e.model,e.model.get("order"))},insertAtIndex:function(e,t){e.collection.createWrapper(this.get("tag"),e.get("parent"),t)},columnBefore:function(e){var t=e.model.get("parent"),n=e.model.get("order")-1;if("tailor_column"==e.model.get("tag")){var i=e.model.collection.createColumn(t,n);e.model.collection.createWrapper(this.get("tag"),i.get("id"),0)}else{var o=e.model.collection.createRow(t,n);e.model.collection.insertChild(e.model,_.last(o)),e.model.collection.createWrapper(this.get("tag"),_.first(o).get("id"),0)}},columnAfter:function(e){var t=e.model.get("parent"),n=e.model.get("order");if("tailor_column"==e.model.get("tag")){var i=e.model.collection.createColumn(t,n);e.model.collection.createWrapper(this.get("tag"),i.get("id"),0)}else{var o=e.model.collection.createRow(t,n);e.model.collection.insertChild(e.model,_.first(o)),e.model.collection.createWrapper(this.get("tag"),_.last(o).get("id"),0)}},createChild:function(e){var t=e.model.get("id"),n=e.model.get("child"),i=e.model.collection.where({parent:t,tag:n}).length,o=e.model.collection.createWrapper(n,t,i,!1);e.model.collection.createWrapper(this.get("tag"),o.get("id"),0)}});e.exports=n},function(e,t,n){var i;i=n(0).extend({templateHelpers:{inputAttrs:function(){var e="";return _.each(this.attrs,(function(t,n){e+=n+'="'+t+'"'})),e}},addSerializedData:function(e){return e.attrs=this.model.get("input_attrs"),e}}),e.exports=i},function(e,t){var n;Backbone.$;n=Backbone.Collection.extend({doSearch:function(e){this.terms!==e&&(this.terms=e,this.terms.length>0&&this.search(this.terms),""===this.terms&&this.each((function(e){e.set("match",!0)})))},search:function(e){var t,n;e=(e=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")).replace(/ /g,")(?=.*"),t=new RegExp("^(?=.*"+e+").+","i"),this.each((function(e){n=this.getHaystack(e),e.set("match",t.test(n))}),this)}}),e.exports=n},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){!function(e,t){"use strict";var i=t(document),o=t(e);n(3),n(4),n(2),n(5),Marionette.Behaviors.behaviorsLookup=function(){return{Resizable:n(69),Panel:n(70),Draggable:n(7)}};var s=n(71);function a(e){return(e=e||"").replace(/_|-|tailor_/gi," ").replace(/(?: |\b)(\w)/g,(function(e){return e.toUpperCase().replace(/\s+/g,"")}))}e.app=new s,e.Tailor={Api:{Setting:n(9)},Notify:n(72),Models:{},Panels:{},Sections:{},Controls:{},Items:{},Helpers:{checkCondition:function(e,t,n){switch(t=t||"",e){case"equals":return t===n;case"not":return _.isArray(n)?-1===n.indexOf(t):t!==n;case"lessThan":return t<parseInt(n,10);case"greaterThan":return t>parseInt(n,10);case"contains":return _.isString(t)&&(t=t.split(",")),_.isArray(n)?0!==_.intersection(n,t).length:-1!==_.indexOf(t,n)}}}},wp.media.view.settings.post.id=e.post.id,app.addRegions({content:"#tailor-sidebar-content",dialog:{selector:"#tailor-dialog-container",regionClass:n(73)},modal:{selector:"#tailor-modal-container",regionClass:n(74)}}),Tailor.Models.Container=n(75),Tailor.Models.Wrapper=n(21),Tailor.Models.Section=n(21),Tailor.Models.Default=n(76),Tailor.Panels.Default=n(77),Tailor.Panels.Empty=n(78),Tailor.Sections.Default=n(79),Tailor.Controls.ButtonGroup=n(81),Tailor.Controls.Checkbox=n(82),Tailor.Controls.Code=n(83),Tailor.Controls.Editor=n(84),Tailor.Controls.Gallery=n(85),Tailor.Controls.Icon=n(86),Tailor.Controls.Image=n(87),Tailor.Controls.InputGroup=n(88),Tailor.Controls.Link=n(89),Tailor.Controls.List=n(90),Tailor.Controls.Radio=n(93),Tailor.Controls.Range=n(94),Tailor.Controls.Select=n(95),Tailor.Controls.SelectMulti=n(96),Tailor.Controls.Style=n(97),Tailor.Controls.Switch=n(98),Tailor.Controls.Text=n(22),Tailor.Controls.Textarea=n(99),Tailor.Controls.Video=n(100),Tailor.Controls.WidgetForm=n(101),Tailor.Controls.Default=n(22),Tailor.Controls.Abstract=n(0),Tailor.lookup=function(e,t,n){if(Tailor.hasOwnProperty(n)){var i=a(e);return Tailor[n].hasOwnProperty(i)||t&&(i=a(t),Tailor[n].hasOwnProperty(i))?Tailor[n][i]:Tailor[n].Default}console.error("Object type "+n+" does not exist")},app.module("module:library",n(102)),app.module("module:templates",n(105)),app.module("module:settings",n(110)),app.module("module:history",n(115)),app.module("module:sections",n(118)),app.module("module:panels",n(122)),app.module("module:modal",n(129)),app.module("module:dialog",n(137)),app.module("module:notification",n(139)),app.module("module:devicePreview",n(140)),n(141),app.on("before:start",(function(t){i.on("heartbeat-send",(function(t,n){n.tailor_post_id=e.post.id})),wp.heartbeat.interval(60),wp.heartbeat.connectNow(),o.on("beforeunload.tailor",(function(t){if(app.hasUnsavedChanges())return e._l10n.confirmPage})).on("unload.tailor",(function(n){e.ajax.send("tailor_unlock_post",{data:{post_id:t.postId,nonce:t.nonces.unlockPost}})}))})),t((function(){app.start({postId:e.post.id,nonces:e._nonces,l10n:e._l10n||[],library:e._library||[],templates:e._templates||[],panels:e._panels||[],sections:e._sections||[],settings:e._settings||[],controls:e._controls||[]})}))}(window,Backbone.$)},function(e,t){var n=Marionette.Behavior.extend({ui:{handle:".modal__title"},events:{mousemove:"onMouseMove",mousedown:"onMouseDown","dblclick @ui.handle":"toggleFullScreen"},initialize:function(){this._isResizing=!1,this._isResizing=!1,this.$ghostPane=jQuery('<div class="ghost-pane"></div>').appendTo("body"),this.addEventListeners()},addEventListeners:function(){var e=this;window.addEventListener("resize",(function(){e.checkPosition()}),!1)},detectEdges:function(e){var t=this.el.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,o=[];return i<8&&o.push("top"),i>=t.height-8&&o.push("bottom"),n<8&&o.push("left"),n>=t.width-8&&o.push("right"),o},onMouseMove:function(e){if(!this._isResizing&&!this._isDragging){this.$el.removeClass("top top-left top-right left right bottom bottom-left bottom-right is-draggable");var t=this.detectEdges(e);!t.length||this.container.classList.contains("is-full-screen")||document.body.classList.contains("mce-fullscreen")?e.target.classList.contains("modal__title")&&this.el.classList.add("is-draggable"):this.$el.addClass(t.join("-"))}},onMouseDown:function(e){if(!this._isResizing&&!this._isDragging){var t=this.detectEdges(e);!t.length||this.$container.hasClass("is-full-screen")||document.body.classList.contains("mce-fullscreen")?e.target===this.ui.handle.get(0)&&this.drag(e):this.resize(e,t)}},resize:function(e,t){var n=this,i=t.join("-"),o=_.contains(t,"top")||_.contains(t,"left")?-1:1;this._isResizing=!0,document.body.classList.add("is-dragging"),document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",(function e(t){n._isResizing=!1,document.body.classList.remove("is-dragging"),document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",e,!1),n.checkPosition(150)}),!1);var s=e.pageX,a=e.pageY,l=parseInt(n.container.style.width,10),r=parseInt(n.container.style.height,10);function c(e){var t=o*(e.pageX-s),c=o*(e.pageY-a);switch(i){case"top":(r+=c)>400&&(n.container.style.height=r+"px",n.container.style.top=parseInt(n.container.style.top,10)-c+"px");break;case"bottom":(r+=c)>400&&(n.container.style.height=r+"px");break;case"left":(l+=t)>300&&(n.container.style.width=l+"px",n.container.style.left=parseInt(n.container.style.left,10)-t+"px");break;case"right":(l+=t)>300&&(n.container.style.width=l+"px");break;case"top-left":r+=c,(l+=t)>300&&(n.container.style.width=l+"px",n.container.style.left=parseInt(n.container.style.left,10)-t+"px"),r>400&&(n.container.style.height=r+"px",n.container.style.top=parseInt(n.container.style.top,10)-c+"px");break;case"top-right":r+=c,(l-=t)>300&&(n.container.style.width=l+"px"),r>400&&(n.container.style.height=r+"px",n.container.style.top=parseInt(n.container.style.top,10)-c+"px");break;case"bottom-left":r-=c,(l+=t)>300&&(n.container.style.width=l+"px",n.container.style.left=parseInt(n.container.style.left,10)-t+"px"),r>400&&(n.container.style.height=r+"px");break;case"bottom-right":r+=c,(l+=t)>300&&(n.container.style.width=l+"px"),r>400&&(n.container.style.height=r+"px")}n.triggerResize(l,r),a=e.pageY,s=e.pageX}},drag:function(e){var t,n,i=this;function o(e){document.body.classList.add("is-dragging"),i.container.style.top=parseInt(i.container.style.top,10)+(e.pageY-n)+"px",i.container.style.left=parseInt(i.container.style.left,10)+(e.pageX-t)+"px",e.pageX<5?i.$ghostPane.css({display:"block"}).addClass("left"):e.pageX>window.innerWidth-5?i.$ghostPane.css({display:"block"}).addClass("right"):e.pageY<5?i.$ghostPane.css({display:"block"}).addClass("top"):(i.resetGhostPane(),i.container.classList.contains("is-full-screen")&&(i.$container.removeClass("is-full-screen is-full-screen-left is-full-screen-right"),i.container.style.top=e.pageY-20+"px",i.container.style.left=e.pageX-parseInt(i.container.style.width,10)/2+"px",i.triggerResize(parseInt(i.container.style.width,10),parseInt(i.container.style.height,10)))),t=e.pageX,n=e.pageY}this._isDragging=!0,document.addEventListener("mousemove",o,!1),document.addEventListener("mouseup",(function e(t){i._isDragging=!1,document.body.classList.remove("is-dragging"),document.removeEventListener("mousemove",o,!1),document.removeEventListener("mouseup",e,!1),i.maybeToggleFullScreen(t)}),!1)},maybeToggleFullScreen:function(e){var t;e.pageY<5?t="top":e.pageX<5?t="left":e.pageX>window.innerWidth-5&&(t="right"),t?this.enterFullScreen(t):this.checkPosition(150)},toggleFullScreen:function(){this.container.classList.contains("is-full-screen")?this.exitFullScreen():this.enterFullScreen("top")},enterFullScreen:function(e){this.$container.removeClass("is-full-screen is-full-screen-left is-full-screen-right"),this.container.classList.add("is-full-screen"),this.container.classList.add("is-full-screen-"+e);var t=this.container.getBoundingClientRect();this.triggerResize(t.width,t.height)},exitFullScreen:function(){this.$container.removeClass("is-full-screen is-full-screen-left is-full-screen-right"),this.triggerResize(parseInt(this.container.style.width,10),parseInt(this.container.style.height,10)),this.checkPosition(150),this.resetGhostPane()},triggerResize:function(e,t){this.view.trigger("modal:resize",e,t)},resetGhostPane:function(){this.$ghostPane.css({display:"none"}),this.$ghostPane[0].className="ghost-pane"},onShow:function(){this.container=this.el.parentNode,this.$container=this.$el.parent(),this.checkPosition()},checkPosition:function(e){e=e||0;var t=parseInt(this.container.style.width,10),n=parseInt(this.container.style.height,10),i=parseInt(this.container.style.top,10),o=parseInt(this.container.style.left,10),s={};i<window.scrollY?s.top=window.scrollY:i+n>window.scrollY+window.innerHeight&&(s.top=Math.max(window.scrollY+window.innerHeight-n,window.scrollY)),o<0?s.left=window.scrollX:o+t>window.scrollX+window.innerWidth&&(s.left=Math.max(window.scrollX+window.innerWidth-t,window.scrollX)),e?this.$container.animate(s,e):this.$container.css(s)},onDestroy:function(){this.$ghostPane.remove()}});e.exports=n},function(e,t){var n=Marionette.Behavior.extend({ui:{backButton:".back-button",helpButton:".help-button",helpDescription:".help-description",searchBar:".search"},events:{"click @ui.helpButton":"toggleHelp","change @ui.searchBar":"doSearch","input @ui.searchBar":"doSearch","keyup @ui.searchBar":"doSearch","search @ui.searchBar":"doSearch"},triggers:{"click @ui.backButton":"back"},toggleHelp:function(){this.ui.helpButton.toggleClass("is-open"),this.ui.helpDescription.slideToggle(150)},doSearch:function(e){this.view.collection.doSearch(e.target.value)}});e.exports=n},function(e,t){var n,i=Backbone.$,o=i(document);n=Marionette.Application.extend({_initialized:!1,el:document.querySelector("#tailor"),onBeforeStart:function(){this._collapsed=!1,this._unsavedChanges=!1,this.saveButton=document.querySelector("#tailor-save"),this.allowableEvents=["canvas:initialize","element:add","element:move","element:resize","navigation:reorder","element:copy","element:delete","elements:restore","template:add","history:undo","history:redo","modal:open","modal:destroy"],this.addEventListeners()},onStart:function(){this._initialized=!0},hasUnsavedChanges:function(){return this._unsavedChanges},addEventListeners:function(){var e=this;e.listenTo(e.channel,["element:add","element:move","element:resize","navigation:reorder","element:copy","element:delete","modal:apply","template:add","sidebar:setting:change"].join(" "),(function(){e.saveButton.disabled=!1,e.saveButton.innerHTML=window._l10n.publish,e._unsavedChanges=!0})),i("#tailor-collapse").on("click",(function(){e._collapsed=!e._collapsed,e.el.classList.toggle("is-collapsed",e._collapsed),e.saveButton.setAttribute("aria-expanded",!e._collapsed),e.triggerMethod("collapse:sidebar")})),i(e.saveButton).on("click",(function(){e.el.classList.add("is-saving"),e.saveButton.setAttribute("disabled",!0);var t=e.channel.request("canvas:elements"),n=e.channel.request("sidebar:settings");window.ajax.send("tailor_save",{data:{post_id:window.post.id,models:JSON.stringify(t.toJSON()),settings:JSON.stringify(n.toJSON()),nonce:window._nonces.save},success:function(){e.saveButton.disabled=!0,e.saveButton.innerHTML=window._l10n.saved,e._unsavedChanges=!1,e.channel.trigger("sidebar:save")},error:function(t){e.saveButton.disabled=!1,t&&t.hasOwnProperty("message")?Tailor.Notify(t.message):"0"==t?Tailor.Notify(window._l10n.expired):"-1"==t?Tailor.Notify(window._l10n.invalid):Tailor.Notify(window._l10n.error)},complete:function(){e.el.classList.remove("is-saving")}})})),e.listenTo(e.channel,"canvas:handshake",e.registerRemoteChannel),o.on("keydown",(function(t){_.contains(["INPUT","SELECT","TEXTAREA"],t.target.tagName)||(t.ctrlKey?89==t.keyCode?e.channel.trigger("history:redo"):90==t.keyCode&&e.channel.trigger("history:undo"):t.metaKey&&90==t.keyCode&&(t.shiftKey?e.channel.trigger("history:redo"):e.channel.trigger("history:undo")))}))},registerRemoteChannel:function(){var e=this.el.querySelector("#tailor-sidebar-preview");if(window.location.origin===e.contentWindow.location.origin){var t=e.contentWindow.app.channel;app.channel.reply("canvas:elements",(function(){return t.request("canvas:elements")})),app.channel.reply("canvas:templates",(function(){return t.request("canvas:templates")})),app.channel.reply("canvas:css",(function(){return t.request("canvas:css")})),app.channel.reply("canvas:element:selected",(function(){return t.request("canvas:element:selected")})),app.listenTo(t,"all",this.forwardRemoteEvent),app.el.classList.add("is-initialized"),app.el.querySelector(".tailor-preview__viewport").classList.add("is-loaded"),app.channel.trigger("sidebar:initialize",app)}},forwardRemoteEvent:function(e){_.contains(this.allowableEvents,e)&&this.channel.trigger.apply(this.channel,arguments)},maybeCollapse:function(e){13===e.keyCode&&this.onCollapse()},maybeSave:function(e){13===e.keyCode&&this.onSave()}}),e.exports=n},function(e,t,n){var i;n(2),(i=function(e){this.options=_.extend({},this.defaults,e),this.el=document.createElement("div"),this.el.className="notification notification--"+this.options.type,this.container=document.getElementById("tailor-notification-container")||document.body,this.initialize()}).prototype={defaults:{message:"",type:"",ttl:3e3,onShow:function(){},onHide:function(){}},initialize:function(){this.el.innerHTML=this.options.message,this.container.insertBefore(this.el,this.container.firstChild)},show:function(){var e=this;e.el.classList.add("is-visible"),"function"==typeof e.options.onShow&&e.options.onShow.call(e),e.session=setTimeout((function(){e.hide()}),e.options.ttl)},hide:function(){var e=this,t=function(n){if(Modernizr.cssanimations){if(n.target!==e.el)return!1;e.el.removeEventListener(window.transitionEndName,t)}e.container.removeChild(e.el),"function"==typeof e.options.onShow&&e.options.onShow.call(e)};clearTimeout(e.session),Modernizr.csstransitions?(e.el.addEventListener(window.transitionEndName,t),e.el.classList.remove("is-visible")):t()}};e.exports=function(e,t){new i({message:e,type:t||"error"}).show()}},function(e,t){var n=Backbone.Marionette.Region.extend({initialize:function(){this.$overlay=jQuery('<div id="overlay"></div>')},onShow:function(e,t,n){this.el.classList.add("is-visible"),this.$overlay.on("click",jQuery.proxy(this.empty,this)).appendTo("body")},onEmpty:function(e,t,n){this.el.classList.remove("is-visible"),this.$overlay.off().detach()}});e.exports=n},function(e,t){var n=Backbone.Marionette.Region.extend({onShow:function(e,t,n){this.el.classList.add("is-visible");var i=this.el.getBoundingClientRect(),o=this.el.style.width?this.el.style.width:i.width;this.el.style.width=o+"px",this.el.style.height||(this.el.style.height=window.innerHeight-40+"px"),this.el.style.top||(this.el.style.top="20px"),this.el.style.left||(document.documentElement.dir&&"rtl"==document.documentElement.dir?this.el.style.left="20px":this.el.style.left=window.innerWidth-(i.width+20)+"px"),this.updateClassName(o),this.listenTo(e,"modal:resize",this.onResize)},onResize:function(e,t){this.updateClassName(e)},updateClassName:function(e){this.$el.toggleClass("is-x-small",e<480).toggleClass("is-small",481<e&&e<767).toggleClass("is-medium",768<e&&e<979).toggleClass("is-large",980<e&&e<1199).toggleClass("is-x-large",e>=1200)},onEmpty:function(e,t,n){this.el.classList.remove("is-visible"),this.stopListening(e,"modal:resize",this.onResize)}});e.exports=n},function(e,t){var n=Backbone.Model.extend({defaults:function(){return{label:"",description:"",tag:"",icon:"",sections:[],controls:[],type:"default",child:"",collection:"library"}},initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"element:add:top",this.insertBefore),this.listenTo(this,"element:add:bottom",this.insertAfter),this.listenTo(this,"element:add:left",this.columnBefore),this.listenTo(this,"element:add:right",this.columnAfter)},insertBefore:function(e){this.insertAtIndex(e.model,e.model.get("order"))},insertAfter:function(e){this.insertAtIndex(e.model,e.model.get("order")+1)},insertAtIndex:function(e,t){var n="tailor_content",i=e.collection.create([{tag:n,atts:{}},{tag:n,atts:{}}],{silent:!0});e.collection.createContainer(this,e.get("parent"),t,i)},columnBefore:function(e){var t,n=e.model.get("parent"),i="tailor_content";if("tailor_column"==e.model.get("tag")){var o=e.model.collection.createColumn(n,e.model.get("order")-1);t=e.model.collection.create([{tag:i,atts:{}},{tag:i,atts:{}}],{silent:!0}),e.model.collection.createContainer(this,o.get("id"),0,t)}else{var s=e.model.collection.createRow(n,e.model.get("order"));e.model.collection.insertChild(e.model,_.last(s)),t=e.model.collection.create([{tag:i,atts:{}},{tag:i,atts:{}}],{silent:!0}),e.model.collection.createContainer(this,_.first(s).get("id"),0,t)}},columnAfter:function(e){var t,n=e.model.get("parent"),i="tailor_content";if("tailor_column"==e.model.get("tag")){var o=e.model.collection.createColumn(n,e.model.get("order"));t=e.model.collection.create([{tag:i,atts:{}},{tag:i,atts:{}}],{silent:!0}),e.model.collection.createContainer(this,o.get("id"),0,t)}else{var s=e.model.collection.createRow(n,e.model.get("order"));e.model.collection.insertChild(e.model,_.first(s)),t=e.model.collection.create([{tag:i,atts:{}},{tag:i,atts:{}}],{silent:!0}),e.model.collection.createContainer(this,_.last(s).get("id"),0,t)}}});e.exports=n},function(e,t){var n=Backbone.Model.extend({defaults:function(){return{label:"",description:"",tag:"",icon:"",sections:[],controls:[],type:"default",child:"",collection:"library"}},initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"element:add:top",this.insertBefore),this.listenTo(this,"element:add:bottom",this.insertAfter),this.listenTo(this,"element:add:left",this.columnBefore),this.listenTo(this,"element:add:right",this.columnAfter),this.listenTo(this,"element:add:center",this.createChild)},insertBefore:function(e){this.insertAtIndex(e.model,e.model.get("order")-1)},insertAfter:function(e){this.insertAtIndex(e.model,e.model.get("order"))},insertAtIndex:function(e,t){e.collection.create([{tag:this.get("tag"),label:this.get("label"),parent:e.get("parent"),type:this.get("type"),order:t}],{})},columnBefore:function(e){var t=e.model.get("parent");if("tailor_column"==e.model.get("tag")){var n=e.model.collection.createColumn(t,e.model.get("order")-1);e.model.collection.create([{tag:this.get("tag"),label:this.get("label"),parent:n.get("id"),type:this.get("type"),order:0}],{at:0})}else{var i=e.model.collection.createRow(t,e.model.get("order"));e.model.collection.create([{tag:this.get("tag"),label:this.get("label"),parent:_.first(i).get("id"),type:this.get("type"),order:0}],{at:0}),e.model.collection.insertChild(e.model,_.last(i))}},columnAfter:function(e){var t=e.model.get("parent");if("tailor_column"==e.model.get("tag")){var n=e.model.collection.createColumn(t,e.model.get("order"));e.model.collection.create([{tag:this.get("tag"),label:this.get("label"),parent:n.get("id"),type:this.get("type"),order:0}],{at:0})}else{var i=e.model.collection.createRow(t,e.model.get("order"));e.model.collection.create([{tag:this.get("tag"),label:this.get("label"),parent:_.last(i).get("id"),type:this.get("type"),order:0}],{at:0}),e.model.collection.insertChild(e.model,_.first(i))}},createChild:function(e){var t=e.model.get("id"),n=e.model.get("child"),i=e.model.collection.where({parent:t,tag:n}).length,o=e.model.collection.createWrapper(n,t,i,!1);e.model.collection.create([{tag:this.get("tag"),label:this.get("label"),parent:o.get("id"),type:this.get("type"),order:0}],{at:0})}});e.exports=n},function(e,t){var n=Marionette.CompositeView.extend({ui:{backButton:".back-button"},triggers:{"click @ui.backButton":"back:home"},behaviors:{Panel:{}},emptyView:Tailor.Panels.Empty,emptyViewOptions:function(){return{type:this.model.get("type")}},childViewContainer:"#items",getChildView:function(){return Tailor.lookup(this.model.get("type"),!1,"Items")},filter:function(e,t,n){switch(this.model.get("type")){case"library":return!_.contains(["tailor_row"],e.get("tag"))&&"child"!=e.get("type");case"default":return e.get("panel")===this.model.get("id");default:return!0}},getTemplate:function(){return"#tmpl-tailor-panel-"+(this.model.get("type")||"default")},serializeData:function(){var e=Marionette.ItemView.prototype.serializeData.apply(this,arguments);return e.items=this.collection,e},onShow:function(){this.ui.backButton.get(0).focus()}});e.exports=n},function(e,t){var n=Marionette.ItemView.extend({className:"empty",initialize:function(e){this.type=e.type},getTemplate:function(){return"#tmpl-tailor-panel-"+(this.type||"default")+"-empty"}});e.exports=n},function(e,t,n){var i=Marionette.CompositeView.extend({ui:{backButton:".back-button"},triggers:{"click @ui.backButton":"back:panel"},behaviors:{Panel:{}},emptyView:n(80),childViewContainer:"#controls",initialize:function(e){this.panel=e.panel},getChildView:function(e){return Tailor.lookup(e.get("type"),!1,"Controls")},filter:function(e,t,n){return"default"!==this.model.get("type")||e.get("section")===this.model.get("id")},getTemplate:function(){return"#tmpl-tailor-section-"+this.model.get("type")},serializeData:function(){var e=Marionette.ItemView.prototype.serializeData.apply(this,arguments);return e.panel=this.panel.get("title"),e},onShow:function(){this.ui.backButton.get(0).focus()}});e.exports=i},function(e,t){var n=Marionette.ItemView.extend({className:"empty",getTemplate:function(){return"#tmpl-tailor-section-"+(this.model.get("type")||"default")+"-empty"}});e.exports=n},function(e,t,n){var i;i=n(0).extend({ui:{input:".control__body .button",mediaButton:".js-setting-group .button",defaultButton:".js-default",controlGroups:".control__body > *"},events:{"click @ui.input":"onFieldChange","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange"},templateHelpers:{active:function(e,t){return t===this.values[e]?"active":""}},onFieldChange:function(e){this.ui.input.filter('[name^="'+this.media+'"]').removeClass("active");var t=e.currentTarget;t.classList.add("active"),this.setValue(t.value)}}),e.exports=i},function(e,t,n){var i;i=n(0).extend({events:{"change @ui.input":"onFieldChange","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange"},templateHelpers:{checked:function(e,t){return-1!==this.values[e].split(",").indexOf(t)?"checked":""}},onFieldChange:function(e){var t=[];_.each(this.ui.input.filter('[name^="'+this.media+'"]:checked'),(function(e){e.checked&&t.push(e.value||0)})),this.setValue(t.join(","))}}),e.exports=i},function(e,t,n){var i,o=window.jQuery;i=n(0).extend({ui:{input:"textarea",mediaButton:".js-setting-group .button",defaultButton:".js-default",controlGroups:".control__body > *"},events:{"click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange"},addSerializedData:function(e){return e.cid=this.cid,e},onRender:function(){var e=this,t=e.model.get("mode");this.editors={},_.each(this.getValues(),(function(n,i){var o=e.ui.input.filter('[name^="'+i+"-"+e.cid+'"]');e.editors[i]=CodeMirror.fromTextArea(o.get(0),{mode:t,lineNumbers:!0,matchBrackets:!0,continueComments:"Enter",viewportMargin:1/0,extraKeys:{F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}}}),e.editors[i].on("change",(function(t){e.setValue(t.getValue())}),this),setTimeout((function(){e.editors[i].refresh()}),10)})),this.updateControlGroups()},restoreDefaults:function(){_.each(this.getSettings(),(function(e,t){var n=e.get("default")||"";e.set("value",n)}))},updateControlGroups:function(){var e=this.media;this.ui.controlGroups.each((function(){o(this).toggleClass("is-hidden",e!=this.id)})),this.ui.mediaButton.each((function(){o(this).toggleClass("active",e==this.getAttribute("data-media"))})),this.editors[e].refresh()},onDestroy:function(){var e=this;_.each(this.getValues(),(function(t,n){e.editors[n].off(),e.editors[n].toTextArea()}))}}),e.exports=i},function(e,t,n){var i;i=n(0).extend({ui:{input:"textarea",mediaButton:".js-setting-group .button",defaultButton:".js-default",controlGroups:".control__body > *"},events:{"blur @ui.input":"onFieldChange","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"restoreDefaults"},getTemplate:function(){var e=document.getElementById("tmpl-tailor-control-editor").innerHTML;return _.template(e.replace(new RegExp("tailor-editor","gi"),"<%= media %>-<%= cid %>").replace(new RegExp("tailor-value","gi"),"<%= values[ media ] %>"))},addSerializedData:function(e){return e.cid=this.cid,e},addEventListeners:function(){this.listenTo(this.getSetting().collection,"change",this.checkDependencies)},maybeRefreshEditor:function(e){e.contains(this.el)&&_.each(this.getValues(),(function(e,t){tinyMCE.execCommand("mceRemoveEditor",!1,t+"-"+this.cid),tinyMCE.execCommand("mceAddEditor",!1,t+"-"+this.cid)}),this)},onAttach:function(){var e=this;_.each(this.getValues(),(function(t,n){var i=n+"-"+e.cid,o=_.extend({},tinyMCEPreInit.qtInit["tailor-editor"],{id:i});quicktags(o),QTags._buttonsInit(),tinyMCEPreInit.mceInit[i]=_.extend({},tinyMCEPreInit.mceInit["tailor-editor"],{id:i,resize:"vertical",height:350,setup:function(t){t.on("change",(function(){t.save(),e.setValue(t.getContent())}))}}),switchEditors.go(i,"tmce"),tinymce.execCommand("mceAddEditor",!0,i)}),this)},restoreDefaults:function(){_.each(this.getSettings(),(function(e){var t=e.get("default")||"";e.set("value",t),tinyMCE.get(e.media+"-"+this.cid).setContent(t)}),this)},onDestroy:function(){_.each(this.getValues(),(function(e,t){tinyMCE.execCommand("mceRemoveEditor",!0,t+"-"+this.cid)}),this)}}),e.exports=i},function(e,t,n){var i;i=n(0).extend({ui:{select:".button--select",change:".button--change",remove:".button--remove",thumbnails:".thumbnails",mediaButton:".js-setting-group .button",defaultButton:".js-default",controlGroups:".control__body > *"},events:{"click @ui.select":"selectImages","click @ui.change":"selectImages","click @ui.remove":"removeImages","click @ui.thumbnails":"selectImages","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange"},addSerializedData:function(e){return e.ids={},_.each(e.values,(function(t,n){e.ids[n]=this.getIds(t)}),this),e},selectImages:function(){_.each(this.getValues(),(function(e,t){if(t==this.media){var n,i=this,o=i.getIds(e),s=this.getSelection(o),a=wp.media({frame:"post",state:o.length?"gallery-edit":"gallery-library",editing:!0,multiple:!0,selection:s});a.on("open",(function(){a.views.get(".media-frame-menu")[0].$el.children().slice(0,2).hide(),n=JSON.stringify(s.toJSON())})).on("update",(function(e){var o=e.pluck("id").join(",");if(i.setValue(o),!_.isEqual(n,JSON.stringify(e.toJSON()))){var s=i.getSetting(t);s.trigger("change",s,o)}})).on("close",(function(){a.dispose()})),a.open()}}),this)},getIds:function(e){return!_.isEmpty(e)&&e.split(",")},removeImages:function(){this.setValue("")},onSettingChange:function(){this.render()},onRender:function(){var e=this;_.each(this.getValues(),(function(t,n){var i=this.getSelection(e.getIds(t));i.more().done((function(){i.props.set({query:!1}),i.unmirror(),i.props.unset("orderby"),e.updateThumbnails(i,n)}))}),this),this.updateControlGroups()},updateThumbnails:function(e,t){var n="",i=e.map((function(e){var t=e.get("sizes");return t.hasOwnProperty("medium")?t.medium.url:t.hasOwnProperty("thumbnail")?t.thumbnail.url:t.hasOwnProperty("full")?t.full.url:""}));i.length&&_.each(i,(function(e){n+='<li class="thumbnail"><img src="'+e+'"/></li>'})),this.ui.controlGroups.filter('[id^="'+t+'"]').find(".thumbnails").removeClass("is-loading").html(n)},getSelection:function(e){var t=wp.media.query({orderby:"post__in",order:"ASC",type:"image",post__in:e});return new wp.media.model.Selection(t.models,{props:t.props.toJSON(),multiple:!0})}}),e.exports=i},function(e,t,n){var i,o=Backbone.$;i=n(0).extend({ui:{select:".button--select",change:".button--change",remove:".button--remove",icon:"i",mediaButton:".js-setting-group .button",defaultButton:".js-default",controlGroups:".control__body > *"},events:{"click @ui.select":"openDialog","click @ui.change":"openDialog","click @ui.remove":"removeIcon","click @ui.icon":"openDialog","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange"},openDialog:function(){var e=this,t={title:"Select Icon",button:window._l10n.select,content:function(){var t=window._kits||{},n=e.getValue();return _.keys(t).length?_.template(document.getElementById("tmpl-tailor-control-icon-select").innerHTML)({kits:t,value:n}):document.getElementById("tmpl-tailor-control-icon-empty").innerHTML},onOpen:function(){var e=this.$el,t=e.find("li"),n=e.find(".icon-kit");this.$el.find(".search--icon").on("input",(function(e){var n=this.value.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");n=n.replace(/ /g,")(?=.*");var i=new RegExp("^(?=.*"+n+").+","i");t.each((function(){this.classList.toggle("is-hidden",!i.test(this.getAttribute("title")))}))})),this.$el.find(".select--icon").on("change",(function(e){var t=this.value;n.removeClass("is-hidden").filter((function(){return this.id!=t})).addClass("is-hidden")}))},onValidate:function(){return o("input[name=icon]:checked").val()},onSave:function(){e.setValue(o("input[name=icon]:checked").val())},onClose:function(){this.$el.find(".search--icon").off("input")}};app.channel.trigger("dialog:open",t)},onSettingChange:function(){this.render()},removeIcon:function(){this.setValue("")}}),e.exports=i},function(e,t,n){var i;i=n(0).extend({ui:{select:".button--select",change:".button--change",remove:".button--remove",mediaButton:".js-setting-group .button",defaultButton:".js-default",controlGroups:".control__body > *",thumbnail:".thumbnail"},events:{"click @ui.select":"openFrame","click @ui.change":"openFrame","click @ui.remove":"removeImage","click @ui.thumbnail":"openFrame","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange"},initialize:function(e){this.frame=wp.media({states:[new wp.media.controller.Library({title:"Select Image",library:wp.media.query({type:["image"]}),multiple:!1,date:!1})]}),this.addEventListeners(),this.checkDependencies()},addEventListeners:function(){_.each(this.getSettings(),(function(e){this.listenTo(e,"change",this.onSettingChange)}),this),this.listenTo(this.getSetting().collection,"change",this.checkDependencies),this.frame.on("select",this.selectImage.bind(this))},openFrame:function(){this.frame.open()},selectImage:function(){var e=this.frame.state().get("selection").first();e.get("sizes");this.setValue(e.get("id"))},updateThumbnail:function(e,t){var n;if(e.hasOwnProperty("medium"))n=e.medium.url;else if(e.hasOwnProperty("thumbnail"))n=e.thumbnail.url;else{if(!e.hasOwnProperty("full"))return;n=e.full.url}this.ui.controlGroups.filter('[id^="'+t+'"]').find(".thumbnails").removeClass("is-loading").html('<li class="thumbnail"><img src="'+n+'"/></li>')},removeImage:function(){this.setValue("")},onSettingChange:function(){this.render()},onRender:function(){_.each(this.getValues(),(function(e,t){if(e){var n=wp.media.attachment(e),i=n.get("sizes");if(i)this.updateThumbnail(i,t);else{var o=this;n.fetch({success:function(){i=n.get("sizes"),o.updateThumbnail(i,t)}})}}}),this),this.updateControlGroups()},onDestroy:function(){this.frame.off().dispose()}}),e.exports=i},function(e,t,n){var i;i=n(0).extend({addSerializedData:function(e){return e.choices=this.model.get("choices"),e.values={},_.each(this.getValues(),(function(t,n){e.values[n]={};var i=[];_.isString(t)&&(i=-1!=t.indexOf(",")?t.split(","):t.split("-"));var o=0;for(var s in e.choices)e.choices.hasOwnProperty(s)&&(e.values[n][s]=i[o],o++)})),e},onFieldChange:function(e){var t=this.ui.input.filter('[name^="'+this.media+'"]').serializeArray(),n=_.map(t,(function(e){return e.value}));this.setValue(n.join(","))}}),e.exports=i},function(e,t,n){var i,o=Backbone.$;i=n(0).extend({ui:{input:"input",select:".button--select",mediaButton:".js-setting-group .button",defaultButton:".js-default",controlGroups:".control__body > *"},events:{"blur @ui.input":"onFieldChange","click @ui.select":"openDialog","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange"},addSerializedData:function(e){return e.placeholder=this.model.get("placeholder"),e},search:function(e){var t=this,n=this.$el.find(".search-results");if(n.length){t.$el.addClass("is-searching");var i={data:{s:e,nonce:window._nonces.query},success:function(e){n.html(e)},complete:function(){t.$el.removeClass("is-searching")}};window.ajax.send("tailor_get_links",i)}},openDialog:function(){var e=this,t={title:"Select content",button:window._l10n.select,content:function(){return'<div class="dialog__container"><input class="search--content" type="search" role="search" placeholder="Search"><span class="spinner"></span><div class="search-results"></div></div>'},onOpen:function(){var t,n=this;this.$el.find(".search--content").on("input",(function(i){clearTimeout(t);var s=this.value;s.length>=3&&""!=o.trim(s)&&(t=setTimeout(o.proxy(e.search,n,s),500))}))},onValidate:function(){return o("input[name=url]:checked").val()},onSave:function(){var t=o("input[name=url]:checked").val();e.setValue(t)},onClose:function(){this.$el.find(".search--content").off("input")}};app.channel.trigger("dialog:open",t)},onSettingChange:function(){this.render()}}),e.exports=i},function(e,t,n){var i=Marionette.CompositeView.extend({childView:n(91),childViewContainer:"#list-items",emptyView:n(92),className:function(){return"control control--"+this.model.get("type")},ui:{button:".js-add"},events:{"click @ui.button":"addItem"},collectionEvents:{add:"updateContent",remove:"updateContent",change:"updateContent"},childEvents:{remove:"deleteItem",toggle:"onToggleItem"},template:"#tmpl-tailor-control-list",serializeData:function(){var e=Backbone.Marionette.ItemView.prototype.serializeData.apply(this,arguments);return e.childLabel=this.child.get("label").toLowerCase(),e},childViewOptions:function(e,t){return{model:e,collection:app.channel.request("sidebar:controls",e),settings:app.channel.request("sidebar:settings",e)}},initialize:function(e){this.element=e.element,this._added=[],this._deleted=[];var t=app.channel.request("sidebar:library",this.element.get("tag"));this.child=app.channel.request("sidebar:library",t.get("child")),this.addEventListeners()},addEventListeners:function(){this.listenTo(app.channel,"modal:apply",this.onApplyModal),this.listenTo(app.channel,"modal:close",this.onCloseModal)},filter:function(e,t,n){return e.get("parent")==this.element.get("id")},onRender:function(){var e=this;this.sortable=Sortable.create(this.$childViewContainer.get(0),{draggable:".list-item",handle:".list-item__title",animation:250,onEnd:function(t){app.channel.trigger("list:change:order",e.el),e.updateOrder()}})},isEmpty:function(){return 0==this.collection.getChildren(this.element).length},onToggleItem:function(e){this.children.each((function(t){t!==e&&t.slideUp()}),this)},onAddChild:function(e){this.children.each((function(t){t!==e&&t.slideUp()}),this)},addItem:function(){var e=this.collection.getChildren(this.element).length,t=_.first(this.collection.create([{tag:this.child.get("tag"),parent:this.element.get("id"),order:e,atts:{title:this.child.get("label")}}],{}));this._added.push(t)},deleteItem:function(e){for(var t=0;t<this._added.length;t++)this._added[t]==e.model&&this._added.splice(t,1);this.collection.remove(e.model),this._deleted.push(e.model)},onApplyModal:function(){this._deleted=[],this._added=[]},onCloseModal:function(){this.collection.add(this._deleted),this.collection.remove(this._added)},updateOrder:function(){this.children.each((function(e){e.model.set("order",e.$el.index())}),this),this.collection.sort({silent:!0}),this.updateContent()},updateContent:function(){var e=this.generateShortcode();this.model.settings[0].set("value",e)},generateShortcode:function(){var e=this,t="",n=this.element.get("id"),i=this.collection.filter((function(t){return t.get("parent")===n&&!e._deleted.hasOwnProperty(t.cid)}));return _.each(i,(function(e){t+=e.toShortcode()})),t},onBeforeDestroy:function(){this.sortable.destroy(),this.collection.sort()}});e.exports=i},function(e,t){var n=Marionette.CompositeView.extend({tagName:"li",className:"list-item",ui:{title:".list-item__title",content:".list-item__content",delete:".js-delete-list-item",close:".js-close-list-item"},triggers:{"click @ui.title":"toggle","click @ui.close":"toggle","click @ui.delete":"delete"},events:{keypress:"onKeyPress"},getChildView:function(e){return Tailor.lookup(e.get("type"),!1,"Controls")},childViewContainer:"#controls",template:"#tmpl-tailor-control-list-item",initialize:function(e){this.settings=e.settings,this._open=!1,this.model.startTracking(),this.addEventListeners()},addEventListeners:function(){this.listenTo(this.settings,"change",this.onChangeSettings),this.listenTo(app.channel,"modal:apply",this.onApplyModal),this.listenTo(app.channel,"modal:close",this.onCloseModal)},updateTitle:function(e,t){this.ui.title.find(":contains("+e+")").html(t)},onKeyPress:function(e){13===e.which&&this.triggerMethod("toggle")},onToggle:function(){this._open?this.slideUp():this.slideDown()},slideUp:function(){var e=this;e._open=!1,e.ui.content.slideUp(150,(function(){e.el.classList.remove("is-open")}))},slideDown:function(){var e=this;e._open=!0,e.ui.content.slideDown(150,(function(){e.el.classList.add("is-open")}))},onDelete:function(){var e=this;e.$el.slideUp(250,(function(){e.triggerMethod("remove")}))},onChangeSettings:function(e){var t=_.clone(this.model.get("atts")),n=e.get("id"),i=e.get("value");"title"==n&&this.updateTitle(t.title,i),t[n]=i,this.model.set("atts",t)},onApplyModal:function(){this.model.stopTracking()},onCloseModal:function(){this.model.resetAttributes()}});e.exports=n},function(e,t){var n=Marionette.ItemView.extend({template:"#tmpl-tailor-control-list-empty"});e.exports=n},function(e,t,n){var i;i=n(0).extend({events:{"change @ui.input":"onFieldChange","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange"},templateHelpers:{checked:function(e,t){return this.values[e]===t?"checked":""}},onFieldChange:function(){this.setValue(this.ui.input.filter('[name^="'+this.media+'"]:checked').val())}}),e.exports=i},function(e,t,n){var i;i=n(0).extend({ui:{range:"input[type=range]",input:"input[type=text]",mediaButton:".js-setting-group .button",defaultButton:".js-default",controlGroups:".control__body > *"},events:{"input @ui.range":"onFieldChange","blur @ui.input":"onFieldChange","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange"},templateHelpers:{inputAttrs:function(){var e="";return _.each(this.attrs,(function(t,n){e+=n+'="'+t+'"'})),e}},addSerializedData:function(e){return e.attrs=this.model.get("input_attrs"),e},onFieldChange:function(e){var t=e.target.value;this.ui.input.filter('[name^="'+this.media+'"]').val(t),this.ui.range.filter('[name^="'+this.media+'"]').val(t),this.setValue(t)}}),e.exports=i},function(e,t,n){var i;i=n(0).extend({ui:{input:"select",mediaButton:".js-setting-group .button",defaultButton:".js-default",controlGroups:".control__body > *"},events:{"change @ui.input":"onFieldChange","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange"},templateHelpers:{selected:function(e,t){return t===this.values[e]?"selected":""}},onRender:function(){_.each(this.getValues(),(function(e,t){var n=this.ui.input.filter('[name^="'+t+'"]');_.each(n,(function(){var t=n.selectize({sortField:"text",placeholder:"Please select an option"});e||t[0].selectize.clear()}))}),this),this.updateControlGroups()},onDestroy:function(){_.each(this.getValues(),(function(e,t){this.ui.input.filter('[name^="'+t+'"]').selectize("destroy")}),this)}}),e.exports=i},function(e,t,n){var i;i=n(0).extend({ui:{input:"select",mediaButton:".js-setting-group .button",defaultButton:".js-default",controlGroups:".control__body > *"},events:{"change @ui.input":"onFieldChange","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange"},templateHelpers:{selected:function(e,t){return-1!==this.values[e].split(",").indexOf(t)?"selected":""}},onRender:function(){_.each(this.getValues(),(function(e,t){var n=this.ui.input.filter('[name^="'+t+'"]');_.each(n,(function(t){if(t.id&&window["ss_"+t.id]){const i=e.split(",");n.selectize({options:window["ss_"+t.id].map((function(e){return{value:e.id,text:e.text,selected:!!i.includes(e.id)}})),items:i,searchField:["value","text"],render:{item:function(e,t){return'<div title="'+t(e.value)+'">'+t(e.text)+"</div>"}},create:!0,sortField:"text",splitOn:/\s?[, ]\s?/})}else n.selectize()}))}),this),this.updateControlGroups()},onFieldChange:function(){for(var e=this.ui.input.filter('[name^="'+this.media+'"]').get(0),t=[],n=0;n<e.length;n++)e[n].selected&&t.push(e[n].value);this.setValue(t.join(","))},onDestroy:function(){_.each(this.getValues(),(function(e,t){this.ui.input.filter('[name^="'+t+'"]').selectize("destroy")}),this)}}),e.exports=i},function(e,t,n){var i;window.jQuery;i=n(0).extend({linked:!0,ui:{input:"input",mediaButton:".js-setting-group .button",defaultButton:".js-default",linkButton:".js-link",controlGroups:".control__body > *"},events:{"input @ui.input":"updateLinkedFields","blur @ui.input":"onFieldChange","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange","click @ui.linkButton":"onLinkButtonChange"},addSerializedData:function(e){return e.choices=this.model.get("choices"),e.values={},_.each(this.getValues(),(function(t,n){e.values[n]={};var i=[];_.isString(t)&&(i=-1!=t.indexOf(",")?t.split(","):t.split("-"));var o=0;for(var s in e.choices)e.choices.hasOwnProperty(s)&&(e.values[n][s]=i[o],o++)})),e},onRender:function(){this.updateControlGroups(),this.updateLinkButton()},onLinkButtonChange:function(){this.linked=!this.linked,this.updateLinkButton()},onFieldChange:function(e){var t=this.ui.input.filter('[name^="'+this.media+'"]').serializeArray(),n=_.map(t,(function(e){return e.value}));this.setValue(n.join(","))},updateLinkButton:function(){this.ui.linkButton.toggleClass("is-active",this.linked)},updateLinkedFields:function(e){this.linked&&this.ui.input.filter('[name^="'+this.media+'"]').filter((function(t,n){return n!=e.currentTarget})).val(e.currentTarget.value)}}),e.exports=i},function(e,t,n){var i;i=n(0).extend({events:{"change @ui.input":"onFieldChange","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange"},templateHelpers:{checked:function(e){return 1==parseInt(this.values[e],10)?"checked":""}},onFieldChange:function(){var e=this.ui.input.filter('[name^="'+this.media+'"]');this.setValue(e.get(0).checked?"1":"0")}}),e.exports=i},function(e,t,n){var i;i=n(0).extend({ui:{input:"textarea",mediaButton:".js-setting-group .button",defaultButton:".js-default",controlGroups:".control__body > *"}}),e.exports=i},function(e,t,n){var i,o=Backbone.$;i=n(0).extend({ui:{select:".button--select",enterUrl:".button--enter",change:".button--change",remove:".button--remove",mediaButton:".js-setting-group .button",defaultButton:".js-default",controlGroups:".control__body > *"},events:{"click @ui.select":"openFrame","click @ui.enterUrl":"openDialog","click @ui.change":"openFrame","click @ui.remove":"removeVideo","click @ui.mediaButton":"onMediaButtonChange","click @ui.defaultButton":"onDefaultButtonChange"},initialize:function(e){this.frame=wp.media({states:[new wp.media.controller.Library({title:"Select Video",library:wp.media.query({type:["video"]}),multiple:!1,date:!1})]}),this.addEventListeners(),this.checkDependencies()},addEventListeners:function(){_.each(this.getSettings(),(function(e){this.listenTo(e,"change",this.onSettingChange)}),this),this.listenTo(this.getSetting().collection,"change",this.checkDependencies),this.frame.on("select",this.selectVideo.bind(this))},openFrame:function(){this.frame.open()},selectVideo:function(){var e=this.frame.state().get("selection").first();this.setValue(e.get("id"))},openDialog:function(){var e=this,t={title:"Enter URL",button:window._l10n.select,content:function(){return'<div class="dialog__container"><input class="search--content" type="search" role="search"></div>'},onValidate:function(){var e=o(".search--content").val();return e&&/^(ftp|http|https):\/\/[^ "]+$/.test(e)},onSave:function(){e.setValue(o(".search--content").val())},onClose:function(){this.$el.find(".search--content").off("input")}};app.channel.trigger("dialog:open",t)},onSettingChange:function(){this.render()},removeVideo:function(){this.setValue("")},onRender:function(){var e=this;_.each(this.getValues(),(function(t,n){if(t){var i=wp.media.attachment(t);i.get("url")?e.updatePreview(i,n):i.fetch({success:function(){e.updatePreview(i,n)}})}}),this),this.updateControlGroups()},updatePreview:function(e,t){var n=e.get("url"),i=e.get("mime");this.ui.controlGroups.filter('[id^="'+t+'"]').find(".video-preview").removeClass("is-loading").html('<video controls><source src="'+n+'" type="'+i+'"></video>')},onDestroy:function(){this.frame.dispose()}}),e.exports=i},function(e,t,n){var i,o=window.jQuery;i=n(0).extend({ui:{},events:{"blur *":"onFieldChange","change *":"onFieldChange"},getTemplateId:function(){return"tmpl-tailor-widget-form-"+this.model.get("widget_id_base")},getTemplate:function(){var e=document.getElementById(this.getTemplateId()),t="";return e&&(t=_.template(e.innerHTML)),t},onRender:function(){var e=this.model.get("widget_id_base"),t=this.$el;this.$el.find("label").addClass("control__title").each((function(){o(this).html(this.innerHTML.replace(":",""))})),_.each(this.getValues(),(function(n,i){if(!_.isEmpty(n)){var o=JSON.parse(n);_.each(o,(function(n,i){var o=t.find('[name="widget-'+e+"[__i__]["+i+']"]');o.length&&("checkbox"==o[0].type||"radio"==o[0].type?o.attr("checked","true"):o.val(n))}))}}),this)},onFieldChange:function(e){var t=this.$el.find("input, select, radio, textarea").serializeArray(),n={};o.each(t,(function(){var e=this.name.match(/\[(.*?)\]/g);if(e&&2==e.length){var t=e[1].substring(1,e[1].length-1);void 0!==n[t]?(n[t].push||(n[t]=[n[t]]),n[t].push(this.value||"")):n[t]=this.value||""}})),this.setValue(JSON.stringify(n)),e.preventDefault(),e.stopImmediatePropagation()},onSettingChange:function(){}}),e.exports=i},function(e,t,n){var i,o=n(103),s=n(104);Tailor.Items.Library=s,i=Marionette.Module.extend({onBeforeStart:function(e){var t=new o(e.library),n=function(e){return e?t.findWhere({tag:e}):t};app.channel.reply("sidebar:library",n)},onStart:function(){app.channel.trigger("module:library:ready",this)}}),e.exports=i},function(e,t,n){var i;i=n(23).extend({model:function(e,t){return new(Tailor.lookup(e.tag,e.type,"Models"))(e,t)},comparator:"label",getHaystack:function(e){return[e.get("label"),e.get("type"),e.get("description"),e.get("badge"),e.get("tag")].join(" ")}}),e.exports=i},function(e,t){var n,i=Backbone.$;n=Marionette.ItemView.extend({events:{click:"onClick",keypress:"onKeyPress"},modelEvents:{"change:match":"onSearch"},behaviors:{Draggable:{}},onClick:function(){var e=this.el;if(!e.classList.contains("is-inactive")){var t=function(n){e.removeEventListener(window.animationEndName,t),e.classList.remove("shake")};Modernizr.cssanimations&&(e.addEventListener(window.animationEndName,t),e.classList.add("shake")),Tailor.Notify(window._l10n.dragElement,"warning")}},getTemplate:function(){return"#tmpl-tailor-panel-library-item"},attachElContent:function(e){var t=i(e);return this.$el.replaceWith(t),this.setElement(t),this},onSearch:function(e){this.el.style.display=e.get("match")?"block":"none"}}),e.exports=n},function(e,t,n){var i,o=n(106),s=n(108),a=n(109);Tailor.Panels.Templates=s,Tailor.Items.Templates=a,i=Marionette.Module.extend({onBeforeStart:function(e){var t=this;this.collection=new o(e.templates);var n=function(){return t.collection};app.channel.reply("sidebar:templates",n)},onStart:function(){app.channel.trigger("module:templates:ready",this)}}),e.exports=i},function(e,t,n){var i;i=n(23).extend({model:n(107),comparator:"name",getHaystack:function(e){return[e.get("id"),e.get("label")].join(" ")}}),e.exports=i},function(e,t){var n=Backbone.Model.extend({defaults:function(){return{id:this.cid,label:"",collection:"template"}},initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"element:add:top",this.insertBefore),this.listenTo(this,"element:add:bottom",this.insertAfter),this.listenTo(this,"element:add:left",this.columnBefore),this.listenTo(this,"element:add:right",this.columnAfter),this.listenTo(this,"element:add:center",this.createChild)},createChild:function(e){var t=e.model.get("id"),n=e.model.get("child"),i=e.model.collection.where({parent:t,tag:n}).length,o=e.model.collection.createWrapper(n,t,i,!1);app.channel.trigger("template:load",this,o.get("id"),0)},columnBefore:function(e){var t=e.model.get("parent");if("tailor_column"==e.model.get("tag")){var n=e.model.collection.createColumn(t,e.model.get("order")-1);app.channel.trigger("template:load",this,n.get("id"),0)}else{var i=e.model.collection.createRow(t,e.model.get("order"));app.channel.trigger("template:load",this,_.first(i).get("id"),0),e.model.collection.insertChild(e.model,_.last(i))}},columnAfter:function(e){var t=e.model.get("parent");if("tailor_column"==e.model.get("tag")){var n=e.model.collection.createColumn(t,e.model.get("order"));app.channel.trigger("template:load",this,n.get("id"),0)}else{var i=e.model.collection.createRow(t,e.model.get("order"));app.channel.trigger("template:load",this,_.last(i).get("id"),0),e.model.collection.insertChild(e.model,_.first(i))}},insertBefore:function(e){app.channel.trigger("template:load",this,e.model.get("parent"),e.model.get("order")-1)},insertAfter:function(e){app.channel.trigger("template:load",this,e.model.get("parent"),e.model.get("order"))}});e.exports=n},function(e,t){var n,i=window._l10n;n=Marionette.CompositeView.extend({ui:{backButton:".back-button",save:".js-save-template",import:".js-import-template",searchForm:".search-form"},events:{"click @ui.save":"save","click @ui.import":"import"},triggers:{"click @ui.backButton":"back:home"},behaviors:{Panel:{}},emptyView:Tailor.Panels.Empty,emptyViewOptions:function(){return{type:this.model.get("type")}},template:"#tmpl-tailor-panel-templates",childViewContainer:"#items",getChildView:function(){return Tailor.lookup(this.model.get("type"),!1,"Items")},serializeData:function(){var e=Marionette.ItemView.prototype.serializeData.apply(this,arguments);return e.items=this.collection,e},onShow:function(){this.ui.backButton.get(0).focus(),0===this.collection.length&&this.ui.searchForm.hide()},onAddChild:function(){this.ui.searchForm.show()},onRemoveChild:function(){0===this.collection.length&&this.ui.searchForm.hide()},import:function(e){var t=this,n={title:i.importTemplate,content:document.querySelector("#tmpl-tailor-dialog-import-template").innerHTML,button:i.import,onOpen:function(){this.el.querySelector("#import-template").focus()},onValidate:function(){var e=this.el.querySelector("#import-template");return e.value&&"json"===/(?:\.([^.]+))?$/.exec(e.value)[1]},onSave:function(){var e=this.el.querySelector("#import-template").files[0];if(!e||e.name.match(/.+\.json/)){var n=new FileReader;n.onload=function(e){var i={label:"",tag:"",models:[],nonce:window._nonces.saveTemplate},o=_.extend(i,JSON.parse(n.result));o.models=JSON.stringify(o.models),t.createTemplate(o,"import")};try{n.readAsText(e)}catch(e){}}},onClose:function(){t.ui.import.focus()}};app.channel.trigger("dialog:open",n)},save:function(){var e,t=app.channel.request("canvas:element:selected"),n=app.channel.request("canvas:elements"),o=[];if(t&&"function"==typeof t.get){var s=function(e){_.each(n.where({parent:e}),(function(e){o.push(e.toJSON()),s(e.get("id"))}))};"child"==t.get("type")&&(t=t.collection.get(t.get("parent"))),s(t.get("id")),(t=t.toJSON()).parent="",o.push(t),e=t.tag}else o=n.models,e="tailor_section";var a=this;app.channel.trigger("dialog:open",{title:i.saveTemplate,content:document.querySelector("#tmpl-tailor-dialog-save-template").innerHTML,button:i.save,onOpen:function(){this.el.querySelector("#save-template").focus()},onValidate:function(){return this.el.querySelector("#save-template").value.trim()},onSave:function(){var t={label:this.el.querySelector("#save-template").value,tag:e,models:JSON.stringify(o),nonce:window._nonces.saveTemplate};a.createTemplate(t,"save")},onClose:function(){a.ui.save.focus()}})},createTemplate:function(e,t){t=t||"save";var n=this,i=n.collection;n.ui.save.prop("disabled",!0),n.ui.import.prop("disabled",!0),window.ajax.send("tailor_save_template",{data:e,success:function(e){i.add({id:e.id,label:e.label,tag:e.tag,type:e.type}),app.channel.trigger("template:"+t)},complete:function(){n.ui.save.prop("disabled",!1),n.ui.import.prop("disabled",!1)}})}}),e.exports=n},function(e,t){var n,i=Backbone.$,o=window._l10n;n=Marionette.ItemView.extend({ui:{delete:".js-delete-template",download:".js-download-template",preview:".js-preview-template"},events:{click:"onClick"},modelEvents:{"change:match":"onSearch"},behaviors:{Draggable:{}},onClick:function(e){switch(e.target){case this.ui.download.get(0):this.download();break;case this.ui.delete.get(0):this.delete();break;case this.ui.preview.get(0):this.preview();break;default:var t=this.el,n=function(e){t.removeEventListener(window.animationEndName,n),t.classList.remove("shake")};Modernizr.cssanimations&&(t.addEventListener(window.animationEndName,n),t.classList.add("shake")),Tailor.Notify(o.dragTemplate,"warning")}},getTemplate:function(){return"#tmpl-tailor-panel-templates-item"},attachElContent:function(e){var t=i(e);return this.$el.replaceWith(t),this.setElement(t),this.el.setAttribute("tabindex",0),this},download:function(){var e=this,t=e.model.get("id");window.ajax.send("tailor_load_template",{data:{template_id:t,nonce:window._nonces.loadTemplate},success:function(n){var i=e.model,o=n.models,s=i.get("label"),a={id:t=s.replace(" ","-").toLowerCase(),label:s,tag:i.get("tag"),type:i.get("type"),models:o};a="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(a));var l=document.getElementById("download-template");l.setAttribute("href",a),l.setAttribute("download","tailor-template-"+t+"-"+Date.now()+".json"),l.click(),app.channel.trigger("template:download")}})},delete:function(){var e=this;window.ajax.send("tailor_delete_template",{data:{id:e.model.get("id"),nonce:window._nonces.deleteTemplate},success:function(){e.$el.slideUp((function(){e.model.trigger("destroy",e.model)})),app.channel.trigger("template:delete")}})},preview:function(){window._urls.view+=(window._urls.view.split("?")[1]?"&":"?")+"template_preview=1&template_id="+this.model.get("id"),window.open(window._urls.view,"_blank"),app.channel.trigger("template:preview")},onSearch:function(e){this.el.style.display=e.get("match")?"block":"none"}}),e.exports=n},function(e,t,n){var i,o=n(111),s=n(113);i=Marionette.Module.extend({onBeforeStart:function(e){var t=this;t.settings={sidebar:new o(e.settings)},t.controls={sidebar:new s(e.controls,{silent:!1,settings:t.settings.sidebar})};var n={getControls:function(e){if(!e)return t.controls.sidebar;var i=e.cid;if(!t.controls.hasOwnProperty(i)){var o=app.channel.request("sidebar:library",e.get("tag")).get("controls")||[],a=n.getSettings(e);t.controls[i]=new s(o,{silent:!1,settings:a})}return t.controls[i]},getSettings:function(e){if(!e)return t.settings.sidebar;var n=e.cid;if(!t.settings.hasOwnProperty(n)){var i=app.channel.request("sidebar:library",e.get("tag")).get("settings")||[];t.settings[n]=new o(i,{element:e})}return t.settings[n].load(),t.settings[n]}};app.channel.reply("sidebar:controls",n.getControls),app.channel.reply("sidebar:settings",n.getSettings),this.listenTo(t.settings.sidebar,"change",this.onChangeSetting)},onStart:function(){app.channel.trigger("module:settings:ready",this)},onChangeSetting:function(e){app.channel.trigger("sidebar:setting:change",e)}}),e.exports=i},function(e,t,n){var i=Backbone.Collection.extend({model:n(112),initialize:function(e,t){t&&t.element&&(this.element=t.element),this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"reset",this.load)},load:function(){var e=this.element.get("atts");this.each((function(t){t.set("value",e[t.get("id")])}),this)}});e.exports=i},function(e,t){var n=Backbone.Model.extend({defaults:{id:"",type:""}});e.exports=n},function(e,t,n){var i=Backbone.Collection.extend({model:n(114),initialize:function(e,t){t&&t.settings&&(this.settings=t.settings),this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"reset",this.onReset)},onReset:function(){var e=[];for(var t in _media_queries)_media_queries.hasOwnProperty(t)&&""!=_media_queries[t].max&&e.push(t);this.each((function(t){var n=t.get("setting");t.settings=this.settings.filter((function(t){var i=t.get("id");if(i==n)return t.media="desktop",!0;var o=_.indexOf(e,i.replace(n+"_",""));return-1!==o&&(t.media=e[o],!0)}))}),this)}});e.exports=i},function(e,t){var n=Backbone.Model.extend({defaults:{id:"",label:"",description:"",type:"",choices:{},priority:0,setting:"",section:""}});e.exports=n},function(e,t,n){var i,o=n(116),s=n(117);Tailor.Items.History=s,i=Marionette.Module.extend({onStart:function(e){var t=this;t.collection=new o;var n=function(e){return e?t.collection.findWhere({id:e}):t.collection};app.channel.reply("sidebar:history",n),this.l10n=e.l10n,this.addEventListeners(),app.channel.trigger("module:history:ready",this)},addEventListeners:function(){this.listenTo(app.channel,"element:add",this.onAddElement),this.listenTo(app.channel,"element:copy",this.onCopyElement),this.listenTo(app.channel,"element:move",this.onMoveElement),this.listenTo(app.channel,"modal:apply",this.onEditElement),this.listenTo(app.channel,"element:delete",this.onDeleteElement),this.listenTo(app.channel,"element:resize",this.onResizeElement),this.listenTo(app.channel,"navigation:reorder",this.onReorderElement),this.listenTo(app.channel,"template:add",this.onAddTemplate),this.listenTo(app.channel,"history:restore",this.restoreSnapshot),this.listenTo(app.channel,"history:undo",this.undoStep),this.listenTo(app.channel,"history:redo",this.redoStep)},onAddElement:function(e){"library"==e.get("collection")&&this.saveSnapshot(this.l10n.added+" "+e.get("label"))},onEditElement:function(e,t){this.saveSnapshot(this.l10n.edited+" "+t.get("label"))},onCopyElement:function(e){this.saveSnapshot(this.l10n.copied+" "+e.get("label"))},onMoveElement:function(e){this.saveSnapshot(this.l10n.moved+" "+e.get("label"))},onDeleteElement:function(e){this.saveSnapshot(this.l10n.deleted+" "+e.get("label"))},onResizeElement:function(e){this.saveSnapshot(this.l10n.resized+" "+e.get("label"))},onReorderElement:function(e){this.saveSnapshot(this.l10n.reordered+" "+e.get("label"))},onAddTemplate:function(e){this.saveSnapshot(this.l10n.added+" "+this.l10n.template+" - "+e.get("label"))},saveSnapshot:function(e){this.collection.save(e)},restoreSnapshot:function(e){this.collection.restore(e)},undoStep:function(){this.collection.undo()},redoStep:function(){this.collection.redo()}}),e.exports=i},function(e,t){var n=Backbone.Collection.extend({maxSize:50,active:null,comparator:function(e){return-e.get("timestamp")},initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"add",this.checkLength),this.listenToOnce(app.channel,"canvas:initialize",(function(){this.save(window._l10n.initialized)}))},save:function(e){if(this.active){var t=this.indexOf(this.active);t>0&&this.remove(this.slice(0,t))}var n=app.channel.request("canvas:elements"),i=app.channel.request("canvas:templates"),o=app.channel.request("canvas:css");console.log(n,i,o);var s=this.add({label:e||"",elements:n?n.toJSON():[],templates:i,css:o,time:this.getTime(),timestamp:_.now()});this.setActive(s)},getTime:function(){var e,t=new Date,n=t.getHours();return n>12?(n-=12,e=" PM"):e=" AM",n+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)+e},restore:function(e){var t=this.findWhere({timestamp:e});if(t&&t!==this.getActive()){this.setActive(t);var n=t.get("elements"),i=t.get("templates"),o=t.get("css");app.channel.trigger("elements:reset",n,i,o)}},undo:function(){if(this.length){var e=this.at(this.indexOf(this.getActive())+1);e&&this.restore(e.get("timestamp"))}},redo:function(){if(this.length&&0!==this.indexOf(this.getActive())){var e=this.at(this.indexOf(this.getActive())-1);e&&this.restore(e.get("timestamp"))}},checkLength:function(){this.length>this.maxSize&&this.pop()},setActive:function(e){this.active=e,this.trigger("change:active",e)},getActive:function(){return this.active}});e.exports=n},function(e,t){var n,i=Backbone.$;n=Marionette.ItemView.extend({events:{click:"restore",keypress:"onKeyPress"},template:"#tmpl-tailor-panel-history-item",initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this.model.collection,"change:active",this.toggleClass)},onRender:function(){this.toggleClass()},attachElContent:function(e){var t=i(e);return this.$el.replaceWith(t),this.setElement(t),this.el.setAttribute("tabindex",0),this},onKeyPress:function(e){13===e.which&&this.restore()},restore:function(){var e=this.model.get("timestamp");app.channel.trigger("before:history:restore",e),app.channel.trigger("history:restore",e)},toggleClass:function(e){e=e||this.model.collection.getActive(),this.$el.toggleClass("is-active",e===this.model)}}),e.exports=n},function(e,t,n){var i,o=n(119),s=n(121);Tailor.Items.Default=s,i=Marionette.Module.extend({onBeforeStart:function(e){var t=this;t.collection={sidebar:new o(e.sections)};var n=function(e){if(!e)return t.collection.sidebar;var n=e.cid;if(!t.collection.hasOwnProperty(n)){var i=app.channel.request("sidebar:library",e.get("tag")).get("sections")||[];t.collection[n]=new o(i)}return t.collection[n]};app.channel.reply("sidebar:sections sidebar:default",n)},onStart:function(){app.channel.trigger("module:sections:ready",this)}}),e.exports=i},function(e,t,n){var i=Backbone.Collection.extend({model:n(120)});e.exports=i},function(e,t){var n=Backbone.Model.extend({defaults:{id:"",title:"",description:"",priority:0,panel:""}});e.exports=n},function(e,t){var n,i=Backbone.$;n=Marionette.ItemView.extend({events:{click:"onClick",keypress:"onKeyPress"},modelEvents:{focus:"onFocus"},template:"#tmpl-tailor-panel-default-item",attachElContent:function(e){var t=i(e);return this.$el.replaceWith(t),this.setElement(t),this.el.setAttribute("tabindex",0),this},onClick:function(){this.triggerMethod("show:section")},onKeyPress:function(e){13===e.which&&this.triggerMethod("show:section")},onFocus:function(){this.el.focus()}}),e.exports=n},function(e,t,n){var i,o=n(123),s=n(125),a=n(128);Tailor.Items.Panels=a,i=Marionette.Module.extend({onBeforeStart:function(e){var t=this;t.collection=new o(e.panels);var n=function(e){return e?t.collection.findWhere({id:e}):t.collection};app.channel.reply("sidebar:panels",n)},onStart:function(){app.content.show(new s({panels:app.channel.request("sidebar:panels"),sections:app.channel.request("sidebar:sections"),controls:app.channel.request("sidebar:controls"),settings:app.channel.request("sidebar:settings")})),app.channel.trigger("module:panels:ready",this)}}),e.exports=i},function(e,t,n){var i=Backbone.Collection.extend({model:n(124)});e.exports=i},function(e,t){var n=Backbone.Model.extend({defaults:{id:"",title:"",description:"",collection:"",priority:0}});e.exports=n},function(e,t,n){var i,o=n(126);i=Marionette.LayoutView.extend({ui:{pageTitle:".back-button"},className:"tailor-sidebar__layout",regions:{panels:"#tailor-sidebar-home",panel:"#tailor-sidebar-panel",section:"#tailor-sidebar-section"},childEvents:{"show:panel":"showPanel","show:section":"showSection","back:home":"displayHome","back:panel":"displayPanel"},template:function(){return document.getElementById("tmpl-tailor-sidebar-layout").innerHTML},initialize:function(e){this.panels=e.panels,this.sections=e.sections,this.controls=e.controls,this.settings=e.settings},onRender:function(){this.showChildView("panels",new o({collection:this.panels}))},showPanel:function(e){this.displayPanel();var t=app.channel.request("sidebar:"+e.model.get("type")),n=Tailor.lookup(e.model.get("type"),!1,"Panels");this.showChildView("panel",new n({model:e.model,collection:t}))},showSection:function(e){this.el.classList.add("section-visible"),this.el.classList.remove("panel-visible");var t=Tailor.lookup(e.model.get("type"),!1,"Sections");this.showChildView("section",new t({model:e.model,collection:this.controls,panel:this.panels.findWhere({id:e.model.get("panel")})}))},displayHome:function(e){this.el.classList.remove("panel-visible"),this.el.classList.remove("section-visible"),e&&e.model.trigger("focus")},displayPanel:function(e){this.el.classList.remove("section-visible"),this.el.classList.add("panel-visible"),e&&e.model.trigger("focus")}}),e.exports=i},function(e,t,n){var i=Marionette.CompositeView.extend({getChildView:function(){return Tailor.lookup("panels",!1,"Items")},childViewContainer:"#items",emptyView:n(127),behaviors:{Panel:{}},template:"#tmpl-tailor-home"});e.exports=i},function(e,t){var n=Marionette.ItemView.extend({className:"empty",template:"#tmpl-tailor-home-empty"});e.exports=n},function(e,t){var n,i=Backbone.$;n=Marionette.ItemView.extend({events:{click:"onClick",keypress:"onKeyPress"},modelEvents:{focus:"onFocus"},template:"#tmpl-tailor-panel-default-item",attachElContent:function(e){var t=i(e);return this.$el.replaceWith(t),this.setElement(t),this.el.setAttribute("tabindex",0),this},onClick:function(){this.triggerMethod("show:panel")},onKeyPress:function(e){13===e.which&&this.triggerMethod("show:panel")},onFocus:function(){this.el.focus()}}),e.exports=n},function(e,t,n){var i,o=n(130);i=Marionette.Module.extend({onStart:function(){var e=function(e){if(app.modal.hasView()){if(e===app.modal.currentView.model)return;app.modal.currentView.triggerMethod("close")}app.modal.show(new o({model:e}))},t=function(){app.modal.empty()};this.listenTo(app.channel,"modal:open",e),this.listenTo(app.channel,"elements:reset",t),app.channel.trigger("module:modal:ready",this)}}),e.exports=i},function(e,t,n){var i,o=n(131),s=n(135);i=Marionette.LayoutView.extend({className:"modal",ui:{close:".js-close",apply:".js-apply"},behaviors:{Resizable:{ui:{handle:".modal__title"}}},triggers:{"click @ui.close":"close","click @ui.apply":"apply"},modelEvents:{destroy:"destroy"},template:"#tmpl-tailor-modal",regions:{tabs:"#tailor-modal-tabs",sections:"#tailor-modal-sections"},initialize:function(){this.isModified=!1,this.settings=app.channel.request("sidebar:settings",this.model),this.addEventListeners(),app.channel.trigger("modal:initialize",this,this.model)},addEventListeners:function(){this.listenTo(this.settings,"change",this.onChange)},onRender:function(){var e=this.model,t=app.channel.request("sidebar:sections",e),n=app.channel.request("sidebar:controls",e);this.showChildView("sections",new o({element:e,collection:t,controls:n})),t.length>1&&(this.showChildView("tabs",new s({collection:t})),this.el.classList.add("has-sections")),e.collection.trigger("edit",e,!0)},onShow:function(){this.ui.close.focus()},onChange:function(e){this.isModified=!0,this.ui.apply.attr("disabled",!1);var t=this.model;t.isTracking()||t.startTracking();var n=e.get("refresh"),i=n.hasOwnProperty("method")&&"js"==n.method;if(i&&n.hasOwnProperty("dependencies"))for(var o in n.dependencies)if(n.dependencies.hasOwnProperty(o)&&_.has(n.dependencies[o],"condition")&&_.has(n.dependencies[o],"value")){var s=e.collection.get(o);if(s&&!Tailor.Helpers.checkCondition(n.dependencies[o].condition,s.get("value"),n.dependencies[o].value)){i=!1;break}}t.set("atts",this.atts(),{silent:i}),i&&t.trigger("change:setting",e,t),app.channel.trigger("canvas:reset")},onApply:function(){this.model.stopTracking(),this.model.set("atts",this.atts()),app.channel.trigger("modal:apply",this,this.model),this.triggerMethod("destroy")},onClose:function(){this.isModified&&(!0===confirm(window._l10n.confirmElement)?this.triggerMethod("apply"):this.model.resetAttributes());app.channel.trigger("modal:close",this),this.triggerMethod("destroy")},onDestroy:function(){this.model.collection.trigger("edit",this.model,!1),app.channel.trigger("modal:destroy",this,this.model)},atts:function(){var e={};return this.settings.each((function(t){var n=t.get("value");null!==n&&(e[t.get("id")]=n)}),this),e}}),e.exports=i},function(e,t,n){var i=Marionette.CollectionView.extend({childView:n(132),emptyView:n(134),childViewOptions:function(e,t){return{model:e,element:this.element,collection:this.controls}},initialize:function(e){this.element=e.element,this.controls=e.controls}});e.exports=i},function(e,t,n){var i=Marionette.CollectionView.extend({tagName:"ul",className:"controls controls--modal",emptyView:n(133),getChildView:function(e){return Tailor.lookup(e.get("type"),!1,"Controls")},childViewOptions:function(e,t){var n={model:e};return"list"===e.get("type")&&(n.element=this.element,n.collection=this.element.collection),n},filter:function(e,t,n){return e.get("section")===this.model.get("id")},initialize:function(e){this.model=e.model,this.element=e.element,this.addEventListeners()},addEventListeners:function(){this.listenTo(this.model.collection,"select",this.onSelect)},onSelect:function(e){this.$el.toggle(e===this.model)}});e.exports=i},function(e,t){var n=Marionette.ItemView.extend({className:"empty",template:"#tmpl-tailor-section-default-empty"});e.exports=n},function(e,t){var n=Marionette.ItemView.extend({className:"empty",template:"#tmpl-tailor-modal-empty"});e.exports=n},function(e,t,n){var i,o=n(136);i=Marionette.CollectionView.extend({tagName:"ul",className:"tabs",childView:o,childEvents:{select:"onSelect"},onRender:function(){this.collection.length>0&&this.children.first().triggerMethod("select")},onSelect:function(e){this.children.each((function(t){t.$el.toggleClass("is-active",e===t)}))}}),e.exports=i},function(e,t){var n=Marionette.ItemView.extend({tagName:"li",className:"tab",attributes:{tabindex:0},events:{click:"select",keypress:"onKeyPress"},template:"#tmpl-tailor-modal-item",select:function(){this.triggerMethod("select")},onSelect:function(){this.model.trigger("select",this.model),this.el.focus()},onKeyPress:function(e){13===e.which&&this.select()}});e.exports=n},function(e,t,n){var i,o=n(138);i=Marionette.Module.extend({onStart:function(){var e=function(e){app.dialog.show(new o(e))};this.listenTo(app.channel,"dialog:open",e),app.channel.trigger("module:dialog:ready",this)}}),e.exports=i},function(e,t){var n;window.jQuery;n=Backbone.Marionette.ItemView.extend({className:"dialog",defaults:{title:"",content:"",button:""},ui:{close:".js-close",content:".dialog__content",save:".js-save"},events:{input:"onChange",change:"onChange"},triggers:{"click @ui.close":"close","click @ui.save":"save"},template:"#tmpl-tailor-dialog",serializeData:function(){return{title:this.title,content:this.content,button:this.button}},initialize:function(e){this.title=e.title||this.defaults.title,this.content=e.content||this.defaults.content,this.button=e.button||this.defaults.button,this.callbacks={validate:e.onValidate,open:e.onOpen,save:e.onSave,close:e.onClose}},onBeforeRender:function(){"function"==typeof this.content&&(this.content=this.content.call(this))},onDomRefresh:function(){"function"==typeof this.callbacks.open&&this.callbacks.open.call(this),this.validate()},onChange:function(){this.validate()},validate:function(){"function"==typeof this.callbacks.validate&&this.ui.save.prop("disabled",!this.callbacks.validate.call(this))},onSave:function(){"function"==typeof this.callbacks.save&&this.callbacks.save.call(this),this.onClose()},onClose:function(){"function"==typeof this.callbacks.close&&this.callbacks.close.call(this),this.triggerMethod("destroy")}}),e.exports=n},function(e,t){var n,i=window.Tailor.Notify;n=Marionette.Module.extend({onStart:function(){this.addEventListeners(),app.channel.trigger("module:notifications:ready",this)},addEventListeners:function(){var e=window._l10n;this.listenTo(app.channel,"sidebar:save",(function(){i(e.savedPage,"success")})),this.listenTo(app.channel,"elements:restore",(function(){i(e.restoreElements,"success")})),this.listenTo(app.channel,"element:delete",(function(){i(e.deletedElement,"success")})),this.listenTo(app.channel,"template:save",(function(){i(e.savedTemplate,"success")})),this.listenTo(app.channel,"template:import",(function(){i(e.importedTemplate,"success")})),this.listenTo(app.channel,"template:add",(function(){i(e.addedTemplate,"success")})),this.listenTo(app.channel,"template:delete",(function(){i(e.deletedTemplate,"success")}))}}),e.exports=n},function(e,t){var n,i=window.jQuery;n=Marionette.Module.extend({device:"desktop",onBeforeStart:function(){var e=this,t=function(){return e.device};app.channel.reply("sidebar:device",t)},onStart:function(){this.$buttons=i(".tailor-sidebar .devices button"),this.preview=document.querySelector(".tailor-preview"),this.viewport=this.preview.querySelector(".tailor-preview__viewport"),this.mediaQueries=window._media_queries,this.setDevice(this.$buttons.get(0).getAttribute("data-device")),this.addEventListeners(),app.channel.trigger("module:devicePreview:ready",this)},addEventListeners:function(){this.$buttons.on("click",this.onClick.bind(this)),app.channel.on("sidebar:device",this.setDevice.bind(this))},onClick:function(e){this.setDevice(e.target.getAttribute("data-device"))},setDevice:function(e){this.device=e;var t=this.$buttons.filter("[data-device='"+this.device+"']");this.$buttons.removeClass("is-active").attr("aria-pressed",!1),t.addClass("is-active").attr("aria-pressed",!0),this.mediaQueries.hasOwnProperty(this.device)&&this.mediaQueries[this.device].max?this.viewport.style.maxWidth=this.mediaQueries[this.device].max:this.viewport.style.maxWidth=""}}),e.exports=n},function(e,t){jQuery;var n=document.querySelector(".tailor__home .title");Tailor.Api.Setting.onChange("sidebar:_post_title",(function(e,t){if(n.hasChildNodes())for(var i=n.childNodes,o=1;o<i.length;o++)3==i[o].nodeType&&-1!==i[o].nodeValue.indexOf(t)&&(i[o].nodeValue=e);document.title=window._l10n.tailoring+e}))}]);